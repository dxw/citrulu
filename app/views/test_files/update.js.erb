// Prepend the current status message to the console
$("#console div.output").prepend("<%=j console_line(@console_msg_hash, @console_msg_type) %>");

// Update the status by the button and re-enable it
$("#editor_status").removeClass("working");
$("#editor_status").html("<%= @status_msg %>");
$("#editor_form input[type='submit']").attr("disabled", false);

// Refresh the banner
// TODO: Be cleverer about when we refresh this? e.g. only when the file actually compiles
$("#limits_banner").replaceWith("<%= escape_javascript(render partial: 'limits_banner')%>")

// Clear existing timeouts (in case the user pressed the save button) and set next one
var save_interval;
clearTimeout(save_interval);
save_interval = setTimeout("window.save_file()", 5000);

// Fire a google analytics event if the update was significant:
// TODO: might be able to just render the partial layouts/_ga_events.html.haml - haven't tried.
<% unless session[:events].nil? %>
  <% session[:events].each do |event|%>
_gaq.push(['_trackEvent', '<%= event[:category]%>', '<%= event[:action]%>', '<%= event[:label]%>', '<%= event[:value]%>']);
  <% end %>
<% end %>

<% session[:events] = Array.new %>
